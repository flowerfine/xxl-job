# xxl-job 执行器

执行器位于应用代码中，调度中心通过 rpc 与执行器通信：

* 调度中心 -> 执行器：
    * 心跳
    * 空闲检测
    * 触发任务
    * 杀死任务
    * 任务日志
* 执行器 -> 调度中心：
    * 任务执行结果
    * 注册
    * 取消注册

在执行器中最重要的功能是任务管理。xxl-job 的原生设计是任务线程+任务队列，执行器收到任务执行请求时，将执行参数推入任务队列，任务线程监听任务队列，执行任务，同时任务线程如果多次从任务队列获取任务失败会自动退出节省资源。

准备将任务线程变更为 actor，使用 actor 自带的邮箱取代任务队列。

设计到任务执行的有 4 个接口：

* 空闲检测。判断任务线程是否在执行任务。通过判断是否正在执行任务和任务队列是否有任务等待。
* 触发任务。推入任务队列。
* 杀死任务。中断任务线程，释放任务线程引用，等待线程结束，JVM 回收线程。
* 任务执行结果。将任务结果发送至调度中心。

因为 actor 封装了内部状态，应用代码只能通过 `ActorRef` 向 actor 发送消息，而无法访问邮箱。所以需要另外的方式判断 actor 是否在执行任务。



jobHandlerBehavior 为任务执行 actor，它有 4 个状态：空闲状态，执行状态

* 空闲状态。只接收任务执行消息和状态检测消息。
* 执行状态。收到任务执行消息后，状态检测消息。

